'use strict';class AtlasStitcher{constructor(){this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d")}draw(a,b,c,h){const k=a.height,f=a.width;var e=b.width;const g=b.height,l=c.padding;c=c.cellSize;const d=c-2*l,m=e+d-1-(e+d-1)%d,p=g+d-1-(g+d-1)%d;this.canvas.width=e;this.canvas.height=g;this.ctx.clearRect(0,0,e,g);e=0;for(const n of b.cellIndexList){if(n!=b.transparentIndex){const q=e%(m/d)*d,r=p-d*(1+intdiv(e,m/d))-(p-g),t=n%(f/c)*c+l,u=k-c*(1+intdiv(n,f/c))+l;this.ctx.drawImage(a,t,u,d,d,q,r,d,d)}e++}h.src=this.canvas.toDataURL("image/png")}}async function getJson(a){return await Promise.all(a.map(b=>fetch(`/cdn/MonoBehaviour/${b}.json`)))}async function collectSprites(a){const b=document.createElement("select"),c={};for(const h of a){if(200!=h.status){console.log(h);continue}a=await h.json();const k=a.m_Name;c[k]=a;for(const f of a.textureDataList)b.add(new Option(f.name,`${k}:${f.name}`))}return{manifest:c,select:b}}const atlasObserver=new IntersectionObserver((a,b)=>{a.forEach(c=>{c.isIntersecting&&(atlasHandler(c.target),b.unobserve(c.target))})}),aprilFoolSpriteMap={alphecca:"takemaru01",akashi:"gunzou01",andrew:"jacob01",barrel:"tindalos01",exio:"nekros01_skin1",furlong:"xolotl01",gammei:"https@//api.housamo.xyz/housamo/unity/atlas/?mode=png&asset=/housamo/adv/Android/texture/character/fg_kyouma01&name=fg_kyouma01&use_filename=asset.png",gomeisa:"wakantanka01",goro:"kimunkamui01",hisaki:"cusith01",huckle:"leib01",isaribi:"typhon01",kyoichi:"taurus01_skin1",marfik:"amatsumara01",melide:"alice01",polaris:"aegir01",procy:"shino01_skin2",pubraseer:"breke01",sadayoshi:"seth01",sui:"arc01"},APRIL_FOOL="april_fool";function addAprilFoolSprite(a,b){a=a[0].split("_")[1];a=aprilFoolSpriteMap[a];void 0!==a&&(a=`${APRIL_FOOL}:${a}`,b.prepend(new Option(APRIL_FOOL,a)),b.value=a)}async function atlasHandler(a){const b=a.dataset.sprites.split(","),c=a.querySelector("img"),h=await getJson(b),{manifest:k,select:f}=await collectSprites(h);a.appendChild(f);f.addEventListener("change",()=>{const e=f.value.split(":");if(e[0]==APRIL_FOOL)e[1].startsWith("http")?c.src=e[1].replace("@",":"):c.src=`https://cdn.housamo.xyz/housamo/unity/Android/fg/fg_${e[1]}.png`;else{var g=k[e[0]],l=g.textureDataList.find(m=>m.name==e[1]),d=new Image;d.onload=()=>{window.atlasSticher=window.atlasSticher||new AtlasStitcher;atlasSticher.draw(d,l,g,c)};d.src=`/cdn/Texture2D/${l.atlasName}.png`}});f.dispatchEvent(new Event("change"))}document.querySelectorAll(".atlas-gallery").forEach(a=>atlasObserver.observe(a));function intdiv(a,b){return Math.floor(a/b)};